generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "mysql"
}

model asistente {
  id          BigInt      @id @default(autoincrement())
  id_canal    BigInt
  nombre      String      @db.VarChar(45)
  tipo        String      @db.VarChar(45)
  estado      String      @db.VarChar(45)
  descripcion String?     @db.Text
  canal       canal       @relation(fields: [id_canal], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_asistente_canal1")
  intencion   intencion[]
  prompt      prompt[]

  @@index([id_canal], map: "fk_asistente_canal1_idx")
}

model canal {
  id           BigInt         @id @default(autoincrement())
  id_negocio  BigInt
  tipo         String         @db.VarChar(45)
  nombre       String         @db.Text
  estado       String         @db.VarChar(45)
  asistente    asistente[]
  negocio     negocio       @relation(fields: [id_negocio], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "canales_ibfk_1")
  canal_config canal_config[]

  @@index([id_negocio], map: "id_negocio")
}

model canal_config {
  id       Int    @id
  id_canal BigInt
  config   Json
  canal    canal  @relation(fields: [id_canal], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_canal_config_canal1")

  @@index([id_canal], map: "fk_canal_config_canal1_idx")
}

model intencion {
  id           BigInt    @id @default(autoincrement())
  id_asistente BigInt
  clave        String?   @db.Text
  nombre       String?   @db.VarChar(45)
  descripcion  String?   @db.Text
  tipo_accion  String?   @db.VarChar(45)
  config       Json?
  activo       Int?      @db.TinyInt
  asistente    asistente @relation(fields: [id_asistente], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_intencion_asistente1")

  @@index([id_asistente], map: "fk_intencion_asistente1_idx")
}

model lead_prospectos {
  id          BigInt    @id @default(autoincrement())
  id_negocio BigInt?
  nombre      String?   @db.Text
  telefono    String?   @db.Text
  fuente      String?   @db.Text
  etapa       String?   @db.Text
  negocio    negocio? @relation(fields: [id_negocio], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "lead_prospectos_ibfk_1")
  mensaje     mensaje[]

  @@index([id_negocio], map: "id_negocio")
}

model mensaje {
  id              BigInt           @id @default(autoincrement())
  id_lead         BigInt?
  rol             String?          @db.Text
  contenido       String?          @db.Text
  tipo            mensaje_tipo?    @default(texto)
  fecha_envio     DateTime?        @default(now()) @db.DateTime(0)
  lead_prospectos lead_prospectos? @relation(fields: [id_lead], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "mensajes_ibfk_1")

  @@index([id_lead], map: "id_lead")
}

model prompt {
  id               BigInt             @id @default(autoincrement())
  id_asistente     BigInt
  titulo           String             @db.VarChar(255)
  prompt_final     String             @db.Text
  fecha_creacion   DateTime?          @default(now()) @db.DateTime(0)
  asistente        asistente          @relation(fields: [id_asistente], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_prompt_asistente1")
  prompt_atributos prompt_atributos[]

  @@index([id_asistente], map: "fk_prompt_asistente1_idx")
}

model prompt_atributos {
  id             BigInt  @id @default(autoincrement())
  id_prompt      BigInt
  clave_variable String? @db.VarChar(100)
  pregunta       String? @db.Text
  respuesta      String  @db.Text
  prompt         prompt  @relation(fields: [id_prompt], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "prompt_atributos_ibfk_1")

  @@index([id_prompt], map: "id_prompt")
}

model usuario {
  tipo                usuario_tipo          @default(cliente)
  estado              usuario_estado        @default(activo)
  email               String                @unique(map: "email") @db.VarChar(255)
  password_hash       String?               @db.VarChar(255)
  nombre              String                @db.VarChar(255)
  created_at          DateTime              @default(now()) @db.DateTime(0)
  email_verificado    Boolean               @default(false)
  id_usuario          BigInt                @id @default(autoincrement())
  provedor            usuario_provedor      @default(EMAIL)
  negocio            negocio[]
  verification_tokens verification_tokens[]
}

model verification_tokens {
  id         String                   @id @db.Char(36)
  id_usuario BigInt
  token_hash String                   @db.VarChar(255)
  type       verification_tokens_type
  expires_at DateTime                 @db.DateTime(0)
  used       Boolean                  @default(false)
  attempts   Int                      @default(0)
  created_at DateTime                 @default(now()) @db.DateTime(0)
  usuario    usuario                  @relation(fields: [id_usuario], references: [id_usuario], onDelete: Cascade)

  @@index([id_usuario], map: "fk_verification_user")
}

model negocio {
  id                 BigInt            @id @default(autoincrement())
  fk_usuario         BigInt
  nombre_negocio     String?           @db.Text
  giro               String?           @db.Text
  ciudad             String?           @db.Text
  horarios           String?           @db.Text
  url_redes_sociales String?           @db.Text
  estado             String?           @db.VarChar(15)
  canal              canal[]
  lead_prospectos    lead_prospectos[]
  usuario            usuario           @relation(fields: [fk_usuario], references: [id_usuario], onDelete: NoAction, onUpdate: NoAction, map: "fk_negocio_usuario1")

  @@index([fk_usuario], map: "fk_negocio_usuario1_idx")
}

enum mensaje_tipo {
  texto
  imagen
  boton
  archivo
}

enum verification_tokens_type {
  EMAIL_VERIFICATION
  PASSWORD_RESET
}

enum usuario_provedor {
  EMAIL
  GOOGLE
}

enum usuario_tipo {
  cliente
  admin
  agente
}

enum usuario_estado {
  activo
  inactivo
}
